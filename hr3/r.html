<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Paradise Hotel - Employee Management</title>
    <script src="https://kit.fontawesome.com/a2d9d5bd8b.js" crossorigin="anonymous"></script>
    <script src="https://cdn.rawgit.com/davidshimjs/qrcodejs/gh-pages/qrcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html5-qrcode/2.3.4/html5-qrcode.min.js"></script>
    <!-- Include jsPDF library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <!-- Include SheetJS library for Excel export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <link rel="stylesheet" href="style.css">
    <style>
         :root {
            --primary-color: #2e8b57;
            --secondary-color: #e0f7fa;
            --accent-color: #26a69a;
            --text-color: #355c7d;
            --light-color: #ffffff;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }
        
        body {
            display: flex;
            min-height: 100vh;
            background-color: #f5f5f5;
            color: var(--text-color);
            overflow-x: hidden;
        }
        /* Sidebar Styles */
        
        .sidebar {
            width: 250px;
            background: #ffffff;
            box-shadow: 2px 0 10px rgba(46, 139, 87, 0.5);
            position: fixed;
            height: 100vh;
            padding: 20px 0;
            transition: transform 0.3s ease;
            z-index: 100;
        }

        .logo-text {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-color);
        }
        /* Menu Item Styles */
        
        .menu-item {
            padding: 15px 25px;
            display: flex;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s ease;
            color: var(--text-color);
            text-decoration: none;
            position: relative;
        }
        
        .menu-item:hover {
            background-color: var(--secondary-color);
            color: var(--primary-color);
        }
        
        .menu-item.active {
            background-color: var(--secondary-color);
            color: var(--primary-color);
            border-left: 4px solid var(--primary-color);
            font-weight: 600;
        }
        /* Main Content Styles */
        
        .main-content {
            margin-left: 250px;
            width: calc(100% - 250px);
            padding: 20px;
            background-color: #f9f9f9;
            min-height: 100vh;
            transition: margin-left 0.3s ease;
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background-color: var(--light-color);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .header h2 {
            font-size: 1.5rem;
            color: var(--primary-color);
        }
        
        .user-info {
            display: flex;
            align-items: center;
        }
        
        .user-info img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-right: 10px;
        }
        /* Dashboard Content Styles */
        
        .dashboard-title {
            font-size: 1.8rem;
            color: var(--primary-color);
            margin-bottom: 20px;
        }
        /* Table Styles */
        
        .table-container {
            overflow-x: auto;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 600px;
        }
        
        th,
        td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }
        
        th {
            background-color: var(--primary-color);
            color: white;
            font-weight: 500;
        }
        
        tr:hover {
            background-color: rgba(224, 247, 250, 0.5);
        }
        /* Status badges */
        
        .status-badge {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: capitalize;
            display: inline-block;
        }
        
        .status-pending {
            background-color: #FFF3CD;
            color: #856404;
        }
        
        .status-resolved {
            background-color: #D4EDDA;
            color: #155724;
        }
        /* Action buttons */
        
        .action-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
            font-weight: 500;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            margin: 2px;
        }
        
        .action-btn i {
            font-size: 0.9rem;
        }
        
        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #247a4a;
        }
        
        .btn-secondary {
            background-color: #6c757d;
            color: white;
        }
        
        .btn-secondary:hover {
            background-color: #5a6268;
        }
        
        .btn-danger {
            background-color: #dc3545;
            color: white;
        }
        
        .btn-danger:hover {
            background-color: #c82333;
        }
        
        .btn-success {
            background-color: #28a745;
            color: white;
        }
        
        .btn-success:hover {
            background-color: #218838;
        }
        /* Search and filter styles */
        
        .header-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .search-filter {
            display: flex;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .search-filter input {
            padding: 8px 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
            min-width: 200px;
            flex-grow: 1;
        }
        
        .search-filter select {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        
        .action-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        /* Modal Styles */
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            overflow-y: auto;
        }
        
        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 20px;
            border-radius: 8px;
            width: 90%;
            max-width: 700px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }
        
        .modal-title {
            font-size: 1.5rem;
            color: var(--primary-color);
        }
        
        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #777;
        }
        
        .close-btn:hover {
            color: #333;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }
        
        .form-control {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
        }
        
        .form-row {
            display: flex;
            gap: 15px;
        }
        
        .form-row .form-group {
            flex: 1;
        }
        
        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid #eee;
            flex-wrap: wrap;
        }
        /* Violation details styles */
        
        .violation-details {
            margin-bottom: 20px;
        }
        
        .detail-row {
            display: flex;
            margin-bottom: 10px;
            flex-wrap: wrap;
        }
        
        .detail-label {
            font-weight: 500;
            width: 150px;
            color: #7f8c8d;
        }
        
        .detail-value {
            flex: 1;
            min-width: 200px;
        }
        /* Violation type tags */
        
        .violation-tag {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
            color: white;
        }
        
        .violation-tag.attendance {
            background-color: #f39c12;
        }
        
        .violation-tag.conduct {
            background-color: #e74c3c;
        }
        
        .violation-tag.performance {
            background-color: #9b59b6;
        }
        
        .violation-tag.other {
            background-color: #95a5a6;
        }
        /* Severity indicators */
        
        .severity-high {
            color: #e74c3c;
            font-weight: 500;
        }
        
        .severity-medium {
            color: #f39c12;
            font-weight: 500;
        }
        
        .severity-low {
            color: #2ecc71;
            font-weight: 500;
        }
        /* Burger menu for mobile */
        
        .burger-menu {
            display: none;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--primary-color);
        }

        .menu-item {
            padding: 15px 25px;
            display: flex;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s ease;
            color: var(--text-color);
            text-decoration: none;
            position: relative;
        }
        
        .menu-item:hover {
            background-color: var(--secondary-color);
            color: var(--primary-color);
        }
        
        .menu-item.active {
            background-color: var(--secondary-color);
            color: var(--primary-color);
            border-left: 4px solid var(--primary-color);
        }
        
        .menu-item i {
            margin-right: 10px;
            font-size: 1.2rem;
        }
        
        .sub-menu {
            display: none;
            padding-left: 20px;
            background-color: #f8f9fa;
        }
        
        .sub-menu.show {
            display: block;
        }
        
        .sub-menu-item {
            display: block;
            padding: 10px 15px;
            color: var(--text-color);
            text-decoration: none;
            transition: all 0.3s;
        }
        
        .sub-menu-item:hover {
            background-color: #e9ecef;
            color: var(--primary-color);
        }
        /* Responsive Styles */
        
        @media (max-width: 992px) {
            .sidebar {
                transform: translateX(-100%);
                position: fixed;
                top: 0;
                left: 0;
                height: 100vh;
                z-index: 1000;
            }
            .sidebar.active {
                transform: translateX(0);
            }
            .main-content {
                margin-left: 0;
                width: 100%;
            }
            .modal-content {
                width: 95%;
                margin: 10% auto;
            }
        }
        
        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                align-items: flex-start;
            }
            .header-controls {
                flex-direction: column;
                align-items: stretch;
                gap: 10px;
            }
            .search-filter {
                flex-direction: column;
                gap: 10px;
            }
            .search-filter input,
            .search-filter select {
                width: 100%;
            }
            .action-buttons {
                justify-content: flex-start;
            }
            .form-row {
                flex-direction: column;
                gap: 0;
            }
            .detail-row {
                flex-direction: column;
                gap: 5px;
            }
            .detail-label {
                width: 100%;
            }
        }
        
        @media (max-width: 576px) {
            .modal-footer {
                flex-direction: column;
                gap: 10px;
            }
            .modal-footer .btn {
                width: 100%;
            }
            .action-btn {
                width: 100%;
                justify-content: center;
            }
        }
    </style>
</head>

<body>
   <!-- Sidebar Navigation -->
   <div class="sidebar">
    <div class="logo-container">
        <span class="logo-text">PARADISE HOTEL</span>
    </div>

    <a href="dashboard.html" class="menu-item">
        <span>Dashboard</span>
    </a>

    <div class="menu-item" id="dataInsightMenu">
        <span>Data Insight</span>
        <i class="fas fa-chevron-down" style="margin-left: auto;"></i>
    </div>
    <div class="sub-menu" id="dataInsightSubMenu">
        <a href="data_insight.html" class="sub-menu-item">Analytics</a>
    </div>


    <a href="employee.html" class="menu-item">
        <span>Employee & Shift Management</span>
    </a>

    <a href="leave.html" class="menu-item">
        <span>Leave Management</span>
    </a>

    <a href="violation.html" class="menu-item active">
        <i class="fas fa-exclamation-triangle"></i>
        <span>Employee Violation</span>
    </a>
</div>

 <!-- Main Content Area -->
 <div class="main-content">
    <div class="header">
        <h2>Admin Dashboard</h2>
        <div class="header-buttons">
            <div class="user-info">
                <span>Admin User</span>
                <button class="sign-out-btn" onclick="signOut()">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Sign Out</span>
                </button>
            </div>
        </div>
    </div>

        <div class="container">
            <div class="header-controls">
                <div class="search-filter">
                    <input type="text" id="searchInput" placeholder="Search by name or case ID" oninput="searchViolations()">
                    <select id="tableFilter" onchange="filterViolations()">
                        <option value="all">All Violations</option>
                        <option value="pending">Pending</option>
                        <option value="resolved">Resolved</option>
                    </select>
                    <button class="btn btn-secondary" onclick="resetFilters()">
                        <i class="fas fa-sync-alt"></i> Reset
                    </button>
                </div>
                <div class="action-buttons">
                    <button class="btn btn-primary" onclick="showAddViolationModal()">
                        <i class="fas fa-plus"></i> Add Violation
                    </button>
                    <button class="btn btn-secondary" onclick="generateReport()">
                        <i class="fas fa-file-pdf"></i> PDF
                    </button>
                    <button class="btn btn-secondary" onclick="exportToExcel()">
                        <i class="fas fa-file-excel"></i> Excel
                    </button>
                </div>
            </div>

            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Case ID</th>
                            <th>Employee</th>
                            <th>Department</th>
                            <th>Violation Type</th>
                            <th>Date</th>
                            <th>Severity</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="violationTableBody">
                        <!-- Violation data will be populated here -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Add Violation Modal -->
    <div id="addViolationModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Add New Violation</h2>
                <span class="close-btn" onclick="closeModal('addViolationModal')">&times;</span>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="employeeSelect">Employee</label>
                    <select id="employeeSelect" class="form-control">
                        <option value="">Select Employee</option>
                        <!-- Employees will be populated via JavaScript -->
                    </select>
                </div>
                <div class="form-group">
                    <label for="violationDate">Date of Violation</label>
                    <input type="date" id="violationDate" class="form-control">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="violationTypeSelect">Violation Type</label>
                        <select id="violationTypeSelect" class="form-control">
                            <option value="">Select Violation Type</option>
                            <!-- Violation types will be populated via JavaScript -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="severitySelect">Severity</label>
                        <select id="severitySelect" class="form-control">
                            <option value="low">Low</option>
                            <option value="medium">Medium</option>
                            <option value="high">High</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label for="violationDescription">Description</label>
                    <textarea id="violationDescription" class="form-control" placeholder="Enter violation details..." rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label for="actionTaken">Action Taken</label>
                    <textarea id="actionTaken" class="form-control" placeholder="Enter action taken..." rows="3"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('addViolationModal')">Cancel</button>
                <button class="btn btn-primary" onclick="saveViolation()">Save Violation</button>
            </div>
        </div>
    </div>

    <!-- View Violation Modal -->
    <div id="viewViolationModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Violation Details - Case #<span id="violationCaseId"></span></h2>
                <span class="close-btn" onclick="closeModal('viewViolationModal')">&times;</span>
            </div>
            <div class="modal-body">
                <div class="violation-details">
                    <div class="detail-row">
                        <div class="detail-label">Employee:</div>
                        <div class="detail-value" id="viewEmployeeName"></div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-label">Department:</div>
                        <div class="detail-value" id="viewDepartment"></div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-label">Date:</div>
                        <div class="detail-value" id="viewDate"></div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-label">Violation Type:</div>
                        <div class="detail-value" id="viewViolationType"></div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-label">Severity:</div>
                        <div class="detail-value" id="viewSeverity"></div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-label">Status:</div>
                        <div class="detail-value" id="viewStatus"></div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-label">Description:</div>
                        <div class="detail-value" id="viewDescription"></div>
                    </div>
                    <div class="detail-row">
                        <div class="detail-label">Action Taken:</div>
                        <div class="detail-value" id="viewActionTaken"></div>
                    </div>
                </div>

                <div id="resolutionSection">
                    <div class="form-group">
                        <label for="resolutionNotes">Resolution Notes</label>
                        <textarea id="resolutionNotes" class="form-control" placeholder="Enter resolution notes..." rows="3"></textarea>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('viewViolationModal')">Close</button>
                <button class="btn btn-primary" id="editBtn" onclick="editViolation()"><i class="fas fa-edit"></i> Edit</button>
                <button class="btn btn-success" id="resolveBtn" onclick="resolveViolation()"><i class="fas fa-check"></i> Resolve</button>
                <button class="btn btn-danger" id="dismissBtn" onclick="dismissViolation()"><i class="fas fa-times"></i> Dismiss</button>
            </div>
        </div>
    </div>

    <script>
        // Toggle sidebar
        function toggleSidebar() {
            const sidebar = document.querySelector('.sidebar');
            const mainContent = document.querySelector('.main-content');

            if (sidebar.style.width === '70px') {
                sidebar.style.width = '250px';
                mainContent.style.marginLeft = '250px';
                mainContent.style.width = 'calc(100% - 250px)';

                // Show menu item text
                document.querySelectorAll('.menu-item span').forEach(el => {
                    el.style.display = 'inline';
                });

                // Show logo text
                document.querySelector('.logo-text').style.display = 'inline';
            } else {
                sidebar.style.width = '70px';
                mainContent.style.marginLeft = '70px';
                mainContent.style.width = 'calc(100% - 70px)';

                // Hide menu item text
                document.querySelectorAll('.menu-item span').forEach(el => {
                    el.style.display = 'none';
                });

                // Hide logo text
                document.querySelector('.logo-text').style.display = 'none';
            }
        }
        // Sample data for employees and violation types
        const employees = [{
            id: "emp001",
            name: "John Doe",
            department: "Sales"
        }, {
            id: "emp002",
            name: "Jane Smith",
            department: "Marketing"
        }, {
            id: "emp003",
            name: "Robert Johnson",
            department: "IT"
        }, {
            id: "emp004",
            name: "Emily Davis",
            department: "HR"
        }, {
            id: "emp005",
            name: "Michael Brown",
            department: "Operations"
        }];

        const violationTypes = [{
            id: "attendance",
            name: "Attendance",
            class: "attendance"
        }, {
            id: "conduct",
            name: "Conduct",
            class: "conduct"
        }, {
            id: "performance",
            name: "Performance",
            class: "performance"
        }, {
            id: "other",
            name: "Other",
            class: "other"
        }];

        // Sample violations data
        let violations = [{
            caseId: "vio001",
            employeeId: "emp001",
            employeeName: "John Doe",
            department: "Sales",
            date: "2023-05-15",
            violationType: "attendance",
            severity: "medium",
            description: "Late arrival for 3 consecutive days without notice",
            actionTaken: "Verbal warning issued",
            status: "pending",
            resolutionNotes: ""
        }, {
            caseId: "vio002",
            employeeId: "emp003",
            employeeName: "Robert Johnson",
            department: "IT",
            date: "2023-05-10",
            violationType: "conduct",
            severity: "high",
            description: "Inappropriate behavior during team meeting",
            actionTaken: "Written warning issued",
            status: "resolved",
            resolutionNotes: "Employee attended sensitivity training"
        }, {
            caseId: "vio003",
            employeeId: "emp002",
            employeeName: "Jane Smith",
            department: "Marketing",
            date: "2023-05-05",
            violationType: "performance",
            severity: "low",
            description: "Missed project deadline",
            actionTaken: "Performance improvement plan initiated",
            status: "pending",
            resolutionNotes: ""
        }];

        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            populateEmployeeDropdown();
            populateViolationTypeDropdown();
            renderViolationTable();
        });

        // Populate employee dropdown
        function populateEmployeeDropdown() {
            const select = document.getElementById('employeeSelect');
            select.innerHTML = '<option value="">Select Employee</option>';

            employees.forEach(employee => {
                const option = document.createElement('option');
                option.value = employee.id;
                option.textContent = `${employee.name} (${employee.department})`;
                select.appendChild(option);
            });
        }

        // Populate violation type dropdown
        function populateViolationTypeDropdown() {
            const select = document.getElementById('violationTypeSelect');
            select.innerHTML = '<option value="">Select Violation Type</option>';

            violationTypes.forEach(type => {
                const option = document.createElement('option');
                option.value = type.id;
                option.textContent = type.name;
                select.appendChild(option);
            });
        }

        // Render the violation table
        function renderViolationTable() {
            const tableBody = document.getElementById('violationTableBody');
            tableBody.innerHTML = '';

            violations.forEach(violation => {
                const row = document.createElement('tr');

                // Get violation type display
                const violationType = violationTypes.find(t => t.id === violation.violationType);
                const typeDisplay = violationType ?
                    `<span class="violation-tag ${violationType.class}">${violationType.name}</span>` :
                    violation.violationType;

                // Severity display
                const severityClass = `severity-${violation.severity}`;
                const severityDisplay = `<span class="${severityClass}">${violation.severity.charAt(0).toUpperCase() + violation.severity.slice(1)}</span>`;

                // Add row data
                row.innerHTML = `
                    <td>${violation.caseId}</td>
                    <td>${violation.employeeName}</td>
                    <td>${violation.department}</td>
                    <td>${typeDisplay}</td>
                    <td>${new Date(violation.date).toLocaleDateString()}</td>
                    <td>${severityDisplay}</td>
                    <td><span class="status-badge status-${violation.status.toLowerCase()}">${violation.status.charAt(0).toUpperCase() + violation.status.slice(1)}</span></td>
                    <td>
                        <button class="action-btn btn-success" onclick="showViewViolationModal('${violation.caseId}')"><i class="fas fa-eye"></i> View</button>
                        <button class="action-btn btn-danger" onclick="deleteViolation('${violation.caseId}')"><i class="fas fa-trash"></i> Delete</button>
                    </td>
                `;

                tableBody.appendChild(row);
            });
        }

        // Show add violation modal
        function showAddViolationModal() {
            // Reset form fields
            document.getElementById('employeeSelect').value = '';
            document.getElementById('violationDate').value = '';
            document.getElementById('violationTypeSelect').value = '';
            document.getElementById('severitySelect').value = 'low';
            document.getElementById('violationDescription').value = '';
            document.getElementById('actionTaken').value = '';

            document.getElementById('addViolationModal').style.display = 'block';
        }

        // Save new violation
        function saveViolation() {
            const employeeId = document.getElementById('employeeSelect').value;
            const date = document.getElementById('violationDate').value;
            const violationType = document.getElementById('violationTypeSelect').value;
            const severity = document.getElementById('severitySelect').value;
            const description = document.getElementById('violationDescription').value;
            const actionTaken = document.getElementById('actionTaken').value;

            // Basic validation
            if (!employeeId || !date || !violationType || !description || !actionTaken) {
                alert('Please fill in all required fields');
                return;
            }

            // Find employee details
            const employee = employees.find(emp => emp.id === employeeId);
            if (!employee) {
                alert('Invalid employee selected');
                return;
            }

            // Generate new case ID
            const newCaseId = 'vio' + (violations.length + 1).toString().padStart(3, '0');

            // Create new violation
            const newViolation = {
                caseId: newCaseId,
                employeeId: employeeId,
                employeeName: employee.name,
                department: employee.department,
                date: date,
                violationType: violationType,
                severity: severity,
                description: description,
                actionTaken: actionTaken,
                status: 'pending',
                resolutionNotes: ''
            };

            // Add to violations array
            violations.unshift(newViolation);

            // Refresh table and close modal
            renderViolationTable();
            closeModal('addViolationModal');
        }

        // Show view violation modal
        function showViewViolationModal(caseId) {
            const violation = violations.find(v => v.caseId === caseId);
            if (!violation) return;

            // Populate modal with violation data
            document.getElementById('violationCaseId').textContent = violation.caseId;
            document.getElementById('viewEmployeeName').textContent = `${violation.employeeName} (${violation.department})`;
            document.getElementById('viewDepartment').textContent = violation.department;
            document.getElementById('viewDate').textContent = new Date(violation.date).toLocaleDateString();

            const violationType = violationTypes.find(t => t.id === violation.violationType);
            document.getElementById('viewViolationType').innerHTML = violationType ?
                `<span class="violation-tag ${violationType.class}">${violationType.name}</span>` :
                violation.violationType;

            const severityClass = `severity-${violation.severity}`;
            document.getElementById('viewSeverity').innerHTML =
                `<span class="${severityClass}">${violation.severity.charAt(0).toUpperCase() + violation.severity.slice(1)}</span>`;

            document.getElementById('viewStatus').innerHTML =
                `<span class="status-badge status-${violation.status.toLowerCase()}">${violation.status.charAt(0).toUpperCase() + violation.status.slice(1)}</span>`;

            document.getElementById('viewDescription').textContent = violation.description;
            document.getElementById('viewActionTaken').textContent = violation.actionTaken;
            document.getElementById('resolutionNotes').value = violation.resolutionNotes || '';

            // Toggle edit and additional action buttons based on status
            if (violation.status === 'resolved') {
                document.getElementById('resolutionSection').style.display = 'none';
                document.getElementById('editBtn').style.display = 'none';
                document.getElementById('resolveBtn').style.display = 'none';
                document.getElementById('dismissBtn').style.display = 'none';
            } else {
                document.getElementById('resolutionSection').style.display = 'block';
                document.getElementById('editBtn').style.display = 'inline-block';
                document.getElementById('resolveBtn').style.display = 'inline-block';
                document.getElementById('dismissBtn').style.display = 'inline-block';
            }

            // Open the modal
            document.getElementById('viewViolationModal').style.display = 'block';
        }

        // Close modal
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        // Edit violation
        function editViolation() {
            const caseId = document.getElementById('violationCaseId').textContent;
            const violation = violations.find(v => v.caseId === caseId);

            if (violation) {
                // Populate form fields with current violation data for editing
                document.getElementById('employeeSelect').value = violation.employeeId;
                document.getElementById('violationDate').value = violation.date;
                document.getElementById('violationTypeSelect').value = violation.violationType;
                document.getElementById('severitySelect').value = violation.severity;
                document.getElementById('violationDescription').value = violation.description;
                document.getElementById('actionTaken').value = violation.actionTaken;

                closeModal('viewViolationModal');
                document.getElementById('addViolationModal').style.display = 'block'; // Open add violation modal for editing

                // Update save button to handle edit instead of create
                const saveBtn = document.querySelector('#addViolationModal .btn-primary');
                saveBtn.textContent = 'Update Violation';
                saveBtn.onclick = function() {
                    updateViolation(caseId);
                };
            }
        }

        // Update existing violation
        function updateViolation(caseId) {
            const violationIndex = violations.findIndex(v => v.caseId === caseId);
            if (violationIndex === -1) return;

            const employeeId = document.getElementById('employeeSelect').value;
            const date = document.getElementById('violationDate').value;
            const violationType = document.getElementById('violationTypeSelect').value;
            const severity = document.getElementById('severitySelect').value;
            const description = document.getElementById('violationDescription').value;
            const actionTaken = document.getElementById('actionTaken').value;

            // Basic validation
            if (!employeeId || !date || !violationType || !description || !actionTaken) {
                alert('Please fill in all required fields');
                return;
            }

            // Find employee details
            const employee = employees.find(emp => emp.id === employeeId);
            if (!employee) {
                alert('Invalid employee selected');
                return;
            }

            // Update violation
            violations[violationIndex] = {
                ...violations[violationIndex],
                employeeId: employeeId,
                employeeName: employee.name,
                department: employee.department,
                date: date,
                violationType: violationType,
                severity: severity,
                description: description,
                actionTaken: actionTaken
            };

            // Refresh table and close modal
            renderViolationTable();
            closeModal('addViolationModal');

            // Reset save button to original state
            const saveBtn = document.querySelector('#addViolationModal .btn-primary');
            saveBtn.textContent = 'Save Violation';
            saveBtn.onclick = saveViolation;
        }

        // Resolve violation
        function resolveViolation() {
            const caseId = document.getElementById('violationCaseId').textContent;
            const resolutionNotes = document.getElementById('resolutionNotes').value;

            const violation = violations.find(v => v.caseId === caseId);
            if (violation) {
                violation.status = 'resolved';
                violation.resolutionNotes = resolutionNotes;
                renderViolationTable();
                closeModal('viewViolationModal');
            }
        }

        // Dismiss violation
        function dismissViolation() {
            const caseId = document.getElementById('violationCaseId').textContent;

            const violationIndex = violations.findIndex(v => v.caseId === caseId);
            if (violationIndex !== -1) {
                violations.splice(violationIndex, 1);
                renderViolationTable();
                closeModal('viewViolationModal');
            }
        }

        // Delete violation
        function deleteViolation(caseId) {
            if (confirm('Are you sure you want to delete this violation?')) {
                const violationIndex = violations.findIndex(v => v.caseId === caseId);
                if (violationIndex !== -1) {
                    violations.splice(violationIndex, 1);
                    renderViolationTable();
                }
            }
        }

        // Search violations
        function searchViolations() {
            const searchInput = document.getElementById('searchInput').value.toLowerCase();
            const filteredViolations = violations.filter(v => {
                return v.employeeName.toLowerCase().includes(searchInput) ||
                    v.caseId.toLowerCase().includes(searchInput);
            });

            // ... (continuing from where the code left off)

            renderFilteredViolations(filteredViolations);
        }

        // Filter violations by status
        function filterViolations() {
            const filterValue = document.getElementById('tableFilter').value;
            let filteredViolations = violations;

            if (filterValue !== 'all') {
                filteredViolations = violations.filter(v => v.status === filterValue);
            }

            renderFilteredViolations(filteredViolations);
        }

        // Render filtered violations
        function renderFilteredViolations(filteredViolations) {
            const tableBody = document.getElementById('violationTableBody');
            tableBody.innerHTML = '';

            filteredViolations.forEach(violation => {
                const row = document.createElement('tr');

                // Get violation type display
                const violationType = violationTypes.find(t => t.id === violation.violationType);
                const typeDisplay = violationType ?
                    `<span class="violation-tag ${violationType.class}">${violationType.name}</span>` :
                    violation.violationType;

                // Severity display
                const severityClass = `severity-${violation.severity}`;
                const severityDisplay = `<span class="${severityClass}">${violation.severity.charAt(0).toUpperCase() + violation.severity.slice(1)}</span>`;

                // Add row data
                row.innerHTML = `
                    <td>${violation.caseId}</td>
                    <td>${violation.employeeName}</td>
                    <td>${violation.department}</td>
                    <td>${typeDisplay}</td>
                    <td>${new Date(violation.date).toLocaleDateString()}</td>
                    <td>${severityDisplay}</td>
                    <td><span class="status-badge status-${violation.status.toLowerCase()}">${violation.status.charAt(0).toUpperCase() + violation.status.slice(1)}</span></td>
                    <td>
                        <button class="action-btn btn-success" onclick="showViewViolationModal('${violation.caseId}')"><i class="fas fa-eye"></i> View</button>
                        <button class="action-btn btn-danger" onclick="deleteViolation('${violation.caseId}')"><i class="fas fa-trash"></i> Delete</button>
                    </td>
                `;

                tableBody.appendChild(row);
            });
        }

        // Reset all filters
        function resetFilters() {
            document.getElementById('searchInput').value = '';
            document.getElementById('tableFilter').value = 'all';
            renderViolationTable();
        }

        // Generate PDF report
        function generateReport() {
            const {
                jsPDF
            } = window.jspdf;
            const doc = new jsPDF();

            // Title
            doc.setFontSize(18);
            doc.text('Violation Management Report', 105, 15, {
                align: 'center'
            });

            // Date
            doc.setFontSize(12);
            doc.text(`Generated on: ${new Date().toLocaleDateString()}`, 105, 25, {
                align: 'center'
            });

            // Table data
            const headers = [
                ['Case ID', 'Employee', 'Department', 'Violation Type', 'Date', 'Severity', 'Status']
            ];

            const data = violations.map(v => {
                const violationType = violationTypes.find(t => t.id === v.violationType);
                const typeName = violationType ? violationType.name : v.violationType;

                return [
                    v.caseId,
                    v.employeeName,
                    v.department,
                    typeName,
                    new Date(v.date).toLocaleDateString(),
                    v.severity.charAt(0).toUpperCase() + v.severity.slice(1),
                    v.status.charAt(0).toUpperCase() + v.status.slice(1)
                ];
            });

            // Add table
            doc.autoTable({
                head: headers,
                body: data,
                startY: 30,
                styles: {
                    fontSize: 10,
                    cellPadding: 2,
                    valign: 'middle'
                },
                headStyles: {
                    fillColor: [46, 139, 87],
                    textColor: 255,
                    fontStyle: 'bold'
                },
                alternateRowStyles: {
                    fillColor: [240, 240, 240]
                },
                margin: {
                    top: 30
                }
            });

            // Save the PDF
            doc.save('Violation_Report.pdf');
        }

        // Export to Excel
        function exportToExcel() {
            // Prepare data
            const data = violations.map(v => {
                const violationType = violationTypes.find(t => t.id === v.violationType);
                const typeName = violationType ? violationType.name : v.violationType;

                return {
                    'Case ID': v.caseId,
                    'Employee': v.employeeName,
                    'Department': v.department,
                    'Violation Type': typeName,
                    'Date': new Date(v.date).toLocaleDateString(),
                    'Severity': v.severity.charAt(0).toUpperCase() + v.severity.slice(1),
                    'Status': v.status.charAt(0).toUpperCase() + v.status.slice(1),
                    'Description': v.description,
                    'Action Taken': v.actionTaken,
                    'Resolution Notes': v.resolutionNotes || 'N/A'
                };
            });

            // Create worksheet
            const ws = XLSX.utils.json_to_sheet(data);

            // Create workbook
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "Violations");

            // Generate and download Excel file
            XLSX.writeFile(wb, "Violation_Report.xlsx");
        }

        // Close modals when clicking outside
        window.onclick = function(event) {
            const modals = document.getElementsByClassName('modal');
            for (let modal of modals) {
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            }
        };


        const dataInsightMenu = document.getElementById('dataInsightMenu');
        // Wait for DOM to be fully loaded before populating the tables
        document.addEventListener('DOMContentLoaded', function() {
            populateRecentActivitiesTable();
        });
          // Toggle data insight menu
          dataInsightMenu.addEventListener('click', toggleDataInsightMenu);

          function toggleDataInsightMenu() {
            dataInsightSubMenu.classList.toggle('show');
        }

            // Search employees
          searchEmployees.addEventListener('input', (e) => {
          renderEmployeeDirectory(e.target.value);
        });

            //Sign Out
        function signOut() {
            // In a real app, this would log the user out
            if(confirm('Are you sure you want to sign out?')) {
                alert('Signing out...');
                // window.location.href = "login.html"; // Redirect to login page
            }
        }
    </script>
</body>

</html>